"use strict";var app={loader:document.getElementById("loader"),navigateur:!1,init:function(){this.getNavigator(),this.checkRoute()},getLocation:function(){var pathArray=window.location.pathname.split("/");return pathArray[pathArray.length-1]},checkRoute:function(){for(var r in app.routes){if("otherwise"==r)return app.routes[r].callback.call(this),!0;if(-1!=app.routes[r].templates.indexOf(this.getLocation()))return app.routes[r].callback.call(this),!0}},getNavigator:function(){var el=document.createElement("div");el.style.webkitTransform="translate(100px) rotate(20deg)",el.style.MozTransform="translate(100px) rotate(20deg)";var styleAttrLowercase=el.getAttribute("style").toLowerCase();return app.navigateur=-1!==styleAttrLowercase.indexOf("moz")?"moz":"webkit",app.navigateur},loading:function(time){setTimeout(function(){this.loader.classList.add("hide")},time)}};app.routes={home:{templates:["index.php",""],callback:function(){app.loading(4e3),app.audio.init(),app.scroller.init(),app.particules.init()}},demo:{templates:["demo.php"],callback:function(){app.loading(5e3),app.audio.init(),app.webgl.init(),app.map.init(),app.timeline.init()}},otherwise:{callback:function(){document.getElementById("body_overflow").style.overflow="auto",document.getElementById("bodyEntreprise").style.height=window.window.innerHeight+"px",app.loading(1e3)}}},app.audio={el:document.getElementById("ambiance"),volEl:document.getElementById("mute"),mute:!1,init:function(){var self=this;self.el.play(),self.volEl.addEventListener("click",self.changeSound,!1)},changeSound:function(e){e=e||window.event,e.preventDefault(),app.audio.el.muted?(app.audio.volEl.classList.remove("mute"),app.audio.el.muted=!1):(app.audio.volEl.classList.add("mute"),app.audio.el.muted=!0)}},app.map={dir:"img/",src:"1984.jpg",el:document.getElementById("map"),zoom_plus:document.getElementById("zoom_plus"),zoom_moins:document.getElementById("zoom_moins"),zoom:0,init:function(){var self=this;self.createImagesTab(),self.showImages(),self.el.style.width=window.innerWidth+"px",self.el.style.height=window.innerHeight+"px",self.zoom_plus.addEventListener("click",function(){self.zoomer()},!1),self.zoom_moins.addEventListener("click",function(){self.dezoomer()},!1)},createImagesTab:function(){this.images=new Array;for(var i=1984;2138>i;i+=5)this.images[i]=i+".jpg"},showImages:function(){var i=0;for(var img_year in this.images){var img=document.createElement("img");img.setAttribute("src",app.map.dir+this.images[img_year]),img.setAttribute("id",img_year),0==i&&img.classList.add("affiche"),i++,app.map.el.appendChild(img)}},zoomer:function(){9!=app.map.zoom&&(app.map.zoom++,app.map.el.style.webkitTransform="scale(1."+app.map.zoom+")")},dezoomer:function(){app.map.zoom>0&&(app.map.zoom--,app.map.el.style.webkitTransform="scale(1."+app.map.zoom+")")},changeImage:function(val){document.querySelector(".affiche").classList.remove("affiche"),document.getElementById(val).classList.add("affiche")}},app.timeline={min:1984,max:2134,step:5,ct:document.getElementById("timeline"),el:document.getElementById("range_input"),out:document.getElementById("nb_annee"),img:document.getElementById("map_img"),image_on:"image_1984.jpg",init:function(){var self=this;self.el.setAttribute("min",self.min),self.el.setAttribute("max",self.max),self.el.setAttribute("step",self.step),self.el.setAttribute("value",self.min),self.el.addEventListener("input",function(){self.movingRange(this.value)},!1),self.setOutput()},movingRange:function(val){app.timeline.updateOutput(val),app.map.changeImage(val)},setOutput:function(){app.timeline.out.innerHTML=this.min},updateOutput:function(val){app.timeline.out.innerHTML=val}},app.particules={init:function(){function color(){AnimParticules.context.fillStyle="rgba(31,31,31,1)",AnimParticules.context.fillRect(0,0,SpiderWeb.ww,SpiderWeb.hh)}function Particules(){this.x=Math.random()*SpiderWeb.ww,this.y=Math.random()*SpiderWeb.hh,this.vx=-1+2*Math.random(),this.vy=-1+2*Math.random(),this.radius=2*Math.random(),this.draw=function(){AnimParticules.context.fillStyle="rgba(255,255,255,1)",AnimParticules.context.beginPath(),AnimParticules.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),AnimParticules.context.fill()}}function createParticles(){for(var e=0;e<particules.nb;e++)particules.array.push(new Particules)}function drawParticles(){color();for(var e=0;e<particules.array.length;e++)particules.array[e].draw();moveParticles()}function moveParticles(){for(var i=0;i<particules.array.length;i++){var p=particules.array[i];p.x+=p.vx,p.y+=p.vy,p.x+p.radius>SpiderWeb.ww?p.x=p.radius:p.x-p.radius<0&&(p.x=SpiderWeb.ww-p.radius),p.y+p.radius>SpiderWeb.hh?p.y=p.radius:p.y-p.radius<0&&(p.y=SpiderWeb.hh-p.radius);for(var s=i+1;s<particules.array.length;s++){var p2=particules.array[s];distanceMouse(p,p2),sketchParticles(p,p2)}}}function distanceMouse(p,p2){var dist,dx=p.x-p2.x,dy=p.y-p2.y;dist=Math.sqrt(dx*dx+dy*dy);var dist_mouse,dx_mouse=p.x-AnimParticules.mouse_pos.x,dy_mouse=p.y-AnimParticules.mouse_pos.y;dist_mouse=Math.sqrt(dx_mouse*dx_mouse+dy_mouse*dy_mouse)}function sketchParticles(p,p2){var dist,dx=p.x-p2.x,dy=p.y-p2.y;dist=Math.sqrt(dx*dx+dy*dy),dist<=AnimParticules.min_dist_particles&&(AnimParticules.context.beginPath(),AnimParticules.context.strokeStyle="rgba(255,255,255,"+(1-dist/AnimParticules.min_dist_particles)+")",AnimParticules.context.moveTo(p.x,p.y),AnimParticules.context.lineTo(p2.x,p2.y),AnimParticules.context.stroke(),AnimParticules.context.closePath())}function activeParticles(){color(),createParticles(),drawParticles(),startParticles()}function startParticles(){drawParticles(),requestAnimFrame(startParticles)}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3)}}();var SpiderWeb={w:window,ww:window.innerWidth,hh:window.innerHeight},AnimParticules={canvas:document.getElementById("particules"),mouse_pos:{x:0,y:0},min_dist_particles:70,status:"mouseleave"},particules={nb:100,array:[]};AnimParticules.context=AnimParticules.canvas.getContext("2d"),AnimParticules.canvas.setAttribute("width",window.innerWidth),AnimParticules.canvas.setAttribute("height",window.innerHeight),SpiderWeb.ww>480&&activeParticles()}},app.scroller={etape:1,scrolling:!1,animation_num:0,animations:!1,ct:document.getElementById("container"),container:document.getElementById("scroller"),go_scroll:document.getElementById("go_scroll"),etapesEl:document.getElementsByClassName("etape"),btn:document.getElementsByClassName("btn_etape"),init:function(){var self=this;self.calculateHeight(),self.etapes=new Array,self.etapes[0]=0;for(var i=1;7>i;i++)self.etapes[i]=i*self.winHeight;self.animations=new Array,self.animations[0]=!1,self.animations[1]=!1,self.animations[2]=[1,2],self.animations[3]=[1,2],self.animations[4]=[1,2,3,4],self.animations[5]=!1,self.go_scroll.addEventListener("click",function(){self.next(1)},!1);for(var i=0;i<self.btn.length;i++)self.btn[i].addEventListener("click",self.cliqueNav,!1);self.ct.addEventListener("mousewheel",self.onsScrolling,!1),document.onkeydown=self.onsScrolling,window.onresize=self.calculateHeight()},calculateHeight:function(){var self=this;self.winHeight=window.innerHeight,self.ct.style.height=self.winHeight+"px",self.container.style.height=6*self.winHeight+"px";for(var i=0;i<self.etapesEl.length;i++)self.etapesEl[i].style.height=self.winHeight+"px"},onsScrolling:function(e){var self=app.scroller;self.scrolling||(e.wheelDeltaY<0||"40"==e.keyCode?(self.hasAnimation(self.etape)?self.animate(self.etape,self.animation_num):self.next(self.etape),self.scrolling=!0,setTimeout(function(){self.scrolling=!1},1e3)):(e.wheelDeltaY>0||"38"==e.keyCode)&&(self.previous(self.etape-1),self.scrolling=!0,setTimeout(function(){self.scrolling=!1},1e3)))},next:function(etape,from){5!=etape&&("click"==from?this.etape=etape+1:this.etape++,this.movingSection(-this.etapes[etape]),this.updateNav(this.etape),this.animation_num=0,this.resetAnimation())},previous:function(etape){0!=etape&&(this.movingSection(-this.etapes[etape-1]),this.etape--,this.updateNav(this.etape),this.animation_num=0,this.resetAnimation())},movingSection:function(y){"webkit"==app.getNavigator()?(this.container.style.WebkitTransform="translate(0px, "+y+"px)",this.container.style.MozTransform="translate(0px, "+y+"px)"):(this.container.style.WebkitTransform="translate(0px, "+y+"px)",this.container.style.MozTransform="translate(0px, "+y+"px)")},updateNav:function(etape){document.querySelector(".btn_etape.active").classList.remove("active"),document.querySelector("#btn_etape_"+etape).classList.add("active")},cliqueNav:function(){var etape=this.getAttribute("date-etape");app.scroller.next(etape-1,"click"),app.scroller.updateNav(etape)},hasAnimation:function(etape){return this.animations[etape].length>0&&this.animations[etape][this.animation_num]?!0:!1},animate:function(etape,num){2==etape&&0==num&&(document.getElementById("first").classList.add("hide"),document.getElementById("infos_l_1").classList.remove("hide"),setTimeout(function(){document.getElementById("infos_l_2").classList.remove("hide"),setTimeout(function(){document.getElementById("infos_l_3").classList.remove("hide"),setTimeout(function(){document.getElementById("infos_l_4").classList.remove("hide")},400)},400)},400)),2==etape&&1==num&&(document.getElementById("infos_l_1").classList.add("hide"),document.getElementById("infos_l_2").classList.add("hide"),document.getElementById("infos_l_3").classList.add("hide"),document.getElementById("infos_l_4").classList.add("hide"),document.getElementById("last").classList.remove("hide")),3==etape&&0==num&&(document.getElementById("first_rayon").classList.add("lancer"),document.getElementById("tooltip_1").classList.add("affiche"),document.getElementById("fleche_rayon_1").classList.add("affiche")),3==etape&&1==num&&(document.getElementById("tooltip_1").classList.remove("affiche"),document.getElementById("fleche_rayon_2").classList.add("affiche"),document.getElementById("last_rayon").classList.add("lancer"),document.getElementById("tooltip_2").classList.add("affiche")),4==etape&&0==num&&(document.getElementById("flux_1").classList.remove("hide"),document.getElementById("dispositif_info_1").classList.remove("hide"),document.getElementById("dispositif_info_5").classList.add("hide")),4==etape&&1==num&&(document.getElementById("flux_1").classList.add("hide"),document.getElementById("dispositif_info_1").classList.add("hide"),document.getElementById("dispositif_info_2").classList.remove("hide"),document.getElementById("flux_2").classList.remove("hide")),4==etape&&2==num&&(document.getElementById("dispositif_info_3").classList.remove("hide"),document.getElementById("dispositif_info_2").classList.add("hide"),document.getElementById("flux_2").classList.add("hide"),document.getElementById("flux_3").classList.remove("hide")),4==etape&&3==num&&(document.getElementById("dispositif_info_3").classList.add("hide"),document.getElementById("dispositif_info_4").classList.remove("hide")),this.animation_num++},resetAnimation:function(){document.getElementById("dispositif_info_5").classList.remove("hide"),document.getElementById("last").classList.add("hide"),document.getElementById("first").classList.remove("hide"),document.getElementById("first_rayon").classList.remove("lancer"),document.getElementById("tooltip_1").classList.remove("affiche"),document.getElementById("fleche_rayon_1").classList.remove("affiche"),document.getElementById("tooltip_1").classList.remove("affiche"),document.getElementById("fleche_rayon_2").classList.remove("affiche"),document.getElementById("last_rayon").classList.remove("lancer"),document.getElementById("tooltip_2").classList.remove("affiche"),document.getElementById("flux_1").classList.add("hide"),document.getElementById("dispositif_info_1").classList.add("hide"),document.getElementById("dispositif_info_4").classList.add("hide"),document.getElementById("flux_1").classList.add("hide"),document.getElementById("dispositif_info_1").classList.add("hide"),document.getElementById("dispositif_info_2").classList.add("hide"),document.getElementById("flux_2").classList.add("hide"),document.getElementById("dispositif_info_3").classList.add("hide"),document.getElementById("dispositif_info_2").classList.add("hide"),document.getElementById("flux_2").classList.add("hide"),document.getElementById("flux_3").classList.add("hide"),document.getElementById("infos_l_1").classList.add("hide"),document.getElementById("infos_l_2").classList.add("hide"),document.getElementById("infos_l_3").classList.add("hide"),document.getElementById("infos_l_4").classList.add("hide")}},window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,app.webgl={stop:!1,clic:!1,date:"",init:function(){function inputValid(){webgl.date&&webgl.date<=2134&&webgl.date>=1984?researchButton.classList.add("valid"):researchButton.classList.remove("valid")}function render(){webgl.stop||(controls.update(),webgl.clic&&onDocumentMouseDown(),clouds.rotation.y+=3e-4,requestAnimationFrame(render),renderer.render(scene,camera))}function createSphere(radius,segments){return new THREE.Mesh(new THREE.SphereGeometry(radius,segments,segments),new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture("img/map.jpg"),bumpMap:THREE.ImageUtils.loadTexture("img/elev_bump_4k.jpg"),bumpScale:.005,specularMap:THREE.ImageUtils.loadTexture("img/water_4k.png"),specular:new THREE.Color("grey")}))}function createClouds(radius,segments){return new THREE.Mesh(new THREE.SphereGeometry(radius+.003,segments,segments),new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture("img/fair_clouds_4k.png"),transparent:!0}))}function createStars(radius,segments){return new THREE.Mesh(new THREE.SphereGeometry(radius,segments,segments),new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("img/galaxy_starfield.png"),side:THREE.BackSide}))}function onDocumentMouseDown(){setTimeout(function(){camera.position.x+=.08*(-.1863812254200405-camera.position.x),camera.position.y+=.08*(.32175391347295-camera.position.y),camera.position.z+=.009*(.14730278476730793-camera.position.z)},5e3)}function changeClic(){webgl.date<=2134&&webgl.date>=1984?(webgl.clic=!0,document.getElementById("loaderLight").classList.add("affiche"),document.getElementById("q").classList.add("onload"),document.getElementById("f").classList.add("onload"),setTimeout(function(){document.getElementById("p").classList.add("onload")},2500),setTimeout(function(){document.getElementById("loaderLight").classList.remove("affiche"),document.getElementById("container").classList.add("container")},6500),setTimeout(function(){webgl.clic=!1},8500),setTimeout(function(){webgl.stop=!0},8e3),setTimeout(function(){document.getElementById("webgl").classList.add("onload")},7500),setTimeout(function(){document.getElementById("mapTime").classList.add("onload"),affichePopin()},8500),setTimeout(function(){document.getElementById("webgl").remove()},8500)):error.classList.remove("invisibility")}function finalPage(){pageFinal.classList.add("ready"),pageFinal.classList.remove("invisibility"),popinSoutien.classList.add("invisibility"),popinSoutien.classList.remove("onload"),timeLineCt.classList.add("contact")}function affichePopin(){setTimeout(function(){popinSoutien.classList.add("onload")},7e3)}function popinAfter(){popinSoutien.classList.add("after"),popinSoutien.classList.remove("onload"),blockPopin.classList.add("invisibility")}var webglEl=document.getElementById("webgl"),inputDate=document.getElementById("inputDate"),crossContact=document.getElementById("crossContact"),researchButton=document.getElementById("locate"),container=document.getElementById("frite"),popinText=document.getElementById("popinText"),popinSoutien=document.getElementById("popinSoutien"),timeLineCt=document.getElementById("ct_timeline"),blockPopin=document.getElementById("blockPopin"),pageFinal=document.getElementById("pageFinal"),error=document.getElementById("textError");if(!Detector.webgl)return void Detector.addGetWebGLMessage(webglEl);popinSoutien.addEventListener("mouseover",function(){blockPopin.classList.remove("invisibility")},!0),popinSoutien.addEventListener("mouseleave",function(){popinSoutien.classList.remove("onload"),blockPopin.classList.add("invisibility"),popinSoutien.classList.add("after")},!0),crossContact.addEventListener("click",function(){popinAfter(),pageFinal.classList.add("invisibility"),timeLineCt.classList.remove("contact"),popinSoutien.classList.remove("invisibility"),blockPopin.classList.add("invisibility")},!0),container.addEventListener("onclick",function(){container.classList.add("")},!0),researchButton.addEventListener("click",changeClic,!0),popinText.addEventListener("click",finalPage,!0),inputDate.addEventListener("input",function(){webgl.date=parseInt(inputDate.value),inputValid()});var radius=.5,segments=32,width=window.innerWidth/.75,height=window.innerHeight,scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(45,width/height,.01,1e3);camera.position.z=1.5;var renderer=new THREE.WebGLRenderer;renderer.setSize(width,height),scene.add(new THREE.AmbientLight(16777215));var sphere=createSphere(radius,segments/2);scene.add(sphere);var clouds=createClouds(radius,segments);scene.add(clouds);var stars=createStars(90,64);scene.add(stars);var controls=new THREE.TrackballControls(camera,container);webglEl.appendChild(renderer.domElement),render()}};